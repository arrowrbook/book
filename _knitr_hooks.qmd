```{r}
#| echo: false


  # Remove personal directories
redact <- function(x) {
  stringr::str_replace_all(
    x,
    "/Users/jkeane.*/(PUMS_smol|PUMS cleaned)/",
    "./data/"
  )
}

default_hook_output <- knitr::knit_hooks$get("output")

custom_hook_output <- function(x, options) {
  x <- redact(x)
  n <- options$out.lines
  if(!is.null(n)) {
    x <- xfun::split_lines(x)
    if (length(x) > n) x <- c(head(x, n), "....\n")
    x <- paste(x, collapse = "\n")
  }
  default_hook_output(x, options)
}

knitr::knit_hooks$set(output = custom_hook_output)

default_hook_error <- knitr::knit_hooks$get("error")

knitr::knit_hooks$set(error = function(x, options) default_hook_error(redact(x), options))
```
